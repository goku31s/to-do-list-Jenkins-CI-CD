apiVersion: v1
kind: Service
metadata:
  name: webapp-service
spec:
  type: NodePort # Must be NodePort for GKE Ingress
  selector:
    app: webapp
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-deployment
spec:
  replicas: 2
  strategy: { type: Recreate }
  selector: { matchLabels: { app: webapp } }
  template:
    metadata: { labels: { app: webapp } }
    spec:
      containers:
      - name: webapp
        image: IMAGE_PLACEHOLDER # Jenkins will replace this
        ports: [{ containerPort: 8080 }]
        env:
        - name: MONGO_URI
          value: "mongodb://mongo-service:27017/"